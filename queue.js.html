<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: queue.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: queue.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const partial = (fn, ...args) => (...rest) => fn(...args, ...rest);

/**
 * Queue constructor
 */
const Queue = function() {
  this.tasks = [];
  this.onDone = result => result;
};

/**
 * Add a new task to the queue
 * @param {Function} fn - task to add to the queue
 * @param {Array} args - array of arguments for task
 * @returns {this}
 */
Queue.prototype.pushTask = function(fn, args = []) {
  const task = partial(fn, ...args);
  this.tasks.push(task);
  return this;
};

/**
 * Set function that will be done after the all task of queue
 * @param {Function} fn - function to be done
 * @returns {this}
 */
Queue.prototype.done = function(fn) {
  this.onDone = fn;
  return this;
};

/**
 * Completion of tasks in the queue and save their result
 * @returns {Promise}
 */
Queue.prototype.doTasks = function() {
  let taskIndex = 0;
  return new Promise(done => {
    const taskResult = index => result => {
      this.tasks[index] = result;
      taskIndex++;
      nextTask();
    };
    const nextTask = () => {
      if (taskIndex &lt; this.tasks.length) {
        this.tasks[taskIndex]()
          .then(taskResult(taskIndex))
          .catch(taskResult(taskIndex));
      } else {
        done(this.onDone(this.tasks));
      }
    };
    nextTask();
  });
};

/**
 * Main function to export
 * @returns {Queue} new instance of Queue
 * @example
 * const q = queue();

  const createTask = v => new Promise(res => setTimeout(() => res(v), v));

  q.pushTask(createTask, [100])
    .pushTask(createTask, [200])
    .pushTask(createTask, [300]);

  q.done(result => console.log(result));
  q.doTasks();
 */
const queue = () => new Queue();

module.exports = queue;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AsyncEmitter.html">AsyncEmitter</a></li></ul><h3>Global</h3><ul><li><a href="global.html#asyncMemoize">asyncMemoize</a></li><li><a href="global.html#map">map</a></li><li><a href="global.html#Queue">Queue</a></li><li><a href="global.html#queue">queue</a></li><li><a href="global.html#reduce">reduce</a></li><li><a href="global.html#retry">retry</a></li><li><a href="global.html#series">series</a></li><li><a href="global.html#some">some</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Mon Jan 04 2021 15:21:06 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
